<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TRS Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;background:#020408;color:#e6eaf2;font-family:Segoe UI,Roboto,sans-serif;padding:20px}
h1{text-align:center;margin-bottom:12px}
.wrap{max-width:700px;margin:auto}
.card{background:#0b1020;border:1px solid rgba(255,255,255,.06);border-radius:16px;padding:18px;margin-bottom:16px}
label{font-size:12px;color:#8a91a6}
input,select,button{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.08);background:#0f1530;color:#fff;margin-top:8px}
button{background:linear-gradient(135deg,#1c2335,#2a3550);border:none;font-weight:600}
.status{font-size:13px;color:#b0b7cc;margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <h1>TRS Dashboard</h1>

  <div class="card">
    <label>VPN Type</label>
    <select id="vpn">
      <option>HA Tunnel</option>
      <option>TLS Tunnel</option>
      <option>HTTP Custom</option>
      <option>HTTP Injector</option>
      <option>ZIVPN</option>
      <option>Nvp Tunnel</option>
      <option>OpenTunnel</option>
      <option>LinkLayer</option>
      <option>Mina Pro Net</option>
      <option>NetMod</option>
      <option>SSH Custom</option>
      <option>KPN Tunnel Rev</option>
    </select>

    <label>VPN Config File</label>
    <input type="file" id="file">

    <label>Release Name</label>
    <input id="release" placeholder="e.g. MTN-2026-W1">

    <button onclick="upload()">Upload & Publish</button>
    <div class="status" id="uStatus"></div>
  </div>
</div>

<script>
if(!sessionStorage.getItem("trs_user")) location="index.html";

const OWNER="DARKVENOMRSA";
const REPO="trs-configs";

async function upload(){
  const f=file.files[0], r=release.value.trim(), v=vpn.value;
  if(!f||!r){uStatus.textContent="Select file and release";return;}
  const reader=new FileReader();
  reader.onload=async()=>{
    const base64=reader.result.split(",")[1];
    const tag=v.replace(/\s+/g,"_")+"-"+r;
    uStatus.textContent="Sending…";
    const res=await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/dispatches`,{
      method:"POST",
      headers:{"Accept":"application/vnd.github+json"},
      body:JSON.stringify({event_type:"trs_upload",client_payload:{filename:f.name,content:base64,release:tag}})
    });
    uStatus.textContent = res.ok ? "Publish started on GitHub…" : "Error "+res.status;
  };
  reader.readAsDataURL(f);
}
</script>
</body>
</html>
