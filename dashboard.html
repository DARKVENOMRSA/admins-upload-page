<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>TRS Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#020408;color:#e6eaf2;font-family:Segoe UI;padding:20px}
.panel{max-width:520px;margin:auto;background:#0b1020;padding:20px;border-radius:16px}
input,button{width:100%;padding:14px;margin-top:12px;border-radius:10px;border:none}
button{background:#1c2335;color:white}
.status{margin-top:12px;font-size:13px}
</style>
</head>
<body>

<div class="panel">
<input type="file" id="file">
<input id="release" placeholder="Release name">
<button onclick="send()">Upload</button>
<div class="status" id="status"></div>
</div>

<script>
if(!sessionStorage.getItem("trs")) location="index.html";

const OWNER="DARKVENOMRSA";
const REPO="trs-configs";

async function send(){
 const f=file.files[0];
 const r=release.value.trim();
 if(!f||!r){status.innerText="Missing file or release";return;}

 const reader=new FileReader();
 reader.onload=async()=>{
   const base64=reader.result.split(",")[1];
   status.innerText="Sending…";

   const res=await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/dispatches`,{
     method:"POST",
     headers:{"Accept":"application/vnd.github+json"},
     body:JSON.stringify({
       event_type:"trs_upload",
       client_payload:{filename:f.name,content:base64,release:r}
     })
   });

   status.innerText=res.ok?"Upload started":"Error "+res.status;
 };
 reader.readAsDataURL(f);
}
</script>

</body>
</html>.status{
  margin-top:15px;
  font-size:13px;
  color:#b0b7cc;
}
</style>
</head>

<body>

<h1>TRS Admin Control</h1>

<div class="panel">
  <input type="file" id="file">
  <input id="release" placeholder="Release name (e.g. MTN-Daily)">
  <button onclick="upload()">Upload & Publish</button>
  <div class="status" id="status"></div>
</div>

<script>
const OWNER="DARKVENOMRSA";
const REPO="trs-configs";
const WORKFLOW="admin-upload.yml";

async function upload(){
  const file=document.getElementById("file").files[0];
  const release=document.getElementById("release").value.trim();
  const status=document.getElementById("status");

  if(!file || !release){
    status.innerText="Select file and release name";
    return;
  }

  status.innerText="Encoding file…";

  const reader=new FileReader();
  reader.onload=async ()=>{
    const base64=reader.result.split(",")[1];

    status.innerText="Sending to GitHub…";

    const res=await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/actions/workflows/${WORKFLOW}/dispatches`,{
      method:"POST",
      headers:{
        "Accept":"application/vnd.github+json",
        "Content-Type":"application/json"
      },
      body:JSON.stringify({
        ref:"main",
        inputs:{
          filename:file.name,
          content:base64,
          release:release
        }
      })
    });

    if(res.status===204){
      status.innerText="Upload started. GitHub is publishing…";
    }else{
      status.innerText="Error: "+res.status;
    }
  };

  reader.readAsDataURL(file);
}
</script>

</body>
</html>
